# 移动端适配

## 基本概念

### 像素

#### 设备像素

* 设备屏幕的物理像素，对于任何设备来讲， 物理像素的数量和大小都是固定的

#### CSS像素

* web开发使用的抽象概念



### 视口

> 1. 概念： body元素的默认宽度是html元素宽度的100%，那么html元素的宽度是基于谁呢？ html的宽度就是基于视口的宽度，**视口相当于是html的父元素**
> 2. 在PC端浏览器：视口只有一个，视口 = 屏幕的宽度
> 3. 在移动端屏幕比较窄，所以产生了**布局视口、视觉视口、理想视口**的概念

#### 布局视口

![默认布局视口图](.\imgs\默认布局视口图.png)

> 1. 为了让手机屏幕上也可以浏览pc端的网站，移动端的布局视口与屏幕宽度不在关联
>
> 2. 移动端的布局视口默认一般为**980px**
>
> 3. 当使用移动端默认布局视口时，PC端网页在移动端展示时会将网页等比缩放使**网页宽度 = 移动端屏幕宽度**然后展示，导致了网页上的字会非常小
>
>    ![默认视口](.\imgs\默认视口.png)



#### 视觉视口

> 用户在移动端屏幕上看到的区域就是视觉视口

#### 理想视口

> 1. 理想的布局视口(**布局视口的理想尺寸**)
> 2. 我们认为移动端布局视口理想的尺寸就是屏幕的宽度

* 将布局视口设置为理想尺寸的标签

  ````html
  <meta name="viewport" content="width=device-width" />
  ````

  



### 设备像素比

> 设备像素比(Device Pixel Ratio 简称：DPR)

* 计算公式(前提：缩放比例为1)

  ````
  设备像素比(DPR) = 设备像素个数 / 理想视口CSS像素个数(device-width)
  ````

* meta标签

  ````html
  <meta name="viewport" content="name=value,name=value" />
  ````

  >其中 content 属性是一个字符串值，字符串是由逗号“，”分隔的 名/值 对组成，共有5个：
  >
  >1. **width**：设置布局视口的宽
  >2. **init-scale**：设置页面的初始缩放程度
  >3. **minimum-scale**：设置了页面最小缩放程度
  >4. **maximum-scale**：设置了页面最大缩放程度
  >5. **user-scalable**：是否允许用户对页面进行缩放操作



* 注意点：
  * **缩小放大指的是css像素的缩小放大**，设备像素的大小和数量是不变的

#### PC端dpr

> 1. dpr为1
> 2. 1css像素 = 1设备像素

* dpr为1 的PC端（scale = 1）

![pc端dpr](.\imgs\pc端dpr.png)

#### 移动端dpr

> 1.常见的移动端dpr为2 或者3

* dpr为2的手机端（scale = 1）

  ![dpr2的手机](.\imgs\dpr2的手机.png)



#### 页面缩放

> 1. 上文所阐述的像素比都是基于页面不缩放的情况下（scale=1）

* 当页面进行缩小时 css像素会缩小  一个css像素会明显小于一个设备像素

  ![dpr页面缩放](.\imgs\dpr页面缩放.png)

  



## rem布局

> 1. 移动端主流的布局方案
> 2. rem是相对尺寸单位，基于html 的 font-size，比如html的font-size是18px,那么1rem就是18px
> 3. **rem布局的思路**：以rem作为页面元素的大小单位，对于不同的屏幕宽度，给html动态设置不同的font-size（通过媒体查询）
> 4. 将不同的屏幕宽度平均分成n份（一般划分为10份）作为html的font-size的依据
>    1. 例如在iphone（6/7/8）为375宽度的 （css像素），那么此时html的font-size就是37.5 = 1rem

### rem布局开发

> 1. **在实际开发中，我们只会对页面元素设置rem，字体一般还是使用固定的px**
>
>    1. 因为我们不希望出现13px  15px这种奇数字号
>    2. 我们不希望在小屏手机上字体变小，同时希望在大屏手机上显示更多的字体
>
> 2. 我们拿到的设计稿一般都是（750）的，（按照将屏幕划分为10份的方法）这时候我们可以设置换算rem基准值75px或者37.5px
>
>    1. 如果rem基准值 设置为75  那么设计稿上元素的尺寸可以直接用于开发尺寸（不需要除2）
>
>       > 1. rem基准值设置为75 相当于我们认为屏幕宽度就是750px（css像素）
>       > 2. 但是我们此时实际的屏幕尺寸是375px（css像素）
>       > 3. 不过不用担心 ，rem设置的像素是动态的，会根据750px得到元素的相对大小（rem单位），自动适应375px的屏幕尺寸，所以没有影响
>       >
>       > **注意：我们在使用到一些现成的ui库的时候，如vantui的元素尺寸是按照375的设计稿，所以必须设置基准值为37.5，否则页面的比例就不对了**
>
>    2. 如果rem基准值 设置为37 那么设计稿上的元素的尺寸需要除2才能得到开发尺寸 （如页面元素为20px * 20px 那么开发时实际需要设置元素为10px * 10px）



## 移动端多倍图

### 使用多倍图的原因

>  因为移动端屏幕设备像素比的原因，我们在移动端页面插入图片时需要使用多倍图

* 如我们开发的页面上有一个20px * 20px（css像素）的图片，如果这个网页在pdr=2的屏幕下图片显示的尺寸是40*40px(设备像素，图片中一共有40\*40个物理像素点)，这个时候我们在页面中就需要使用二倍图
  * 插入一张40\*40的图片 缩小至 20\*20（css像素）,当我们的在dpr=2的屏幕上图片显示的就是40\*40（设备像素）的（图片的原始尺寸）



> 使用多倍图的时候同样需要使用到媒体查询，当dpr=2的时候使用二倍图   当dpr=3的时候使用3倍图



## 移动端1px问题

### 产生的原因

* 因为移动端屏幕设备像素比（2/3），所以在给页面设置1px的边框，在真是的屏幕下：（dpr=2）的屏幕显示2px （设备像素）  ， （dpr=3）的屏幕下显示3px（设备像素）
  * 我们的需求： 在任何屏幕下，1px的 边框都显示1px（设备像素）的粗细

### 解决方案

> 解决方案： 使用媒体查询，根据设备的像素比将线条缩小为 **1/ 设备像素比**

* 如dpr=2的设备缩小为0.5
* dpr = 3的设备缩小为0.333
* dpr = 1.5的设备缩小为0.7

```scss
@mixin border-1px-bottom ($bgc) {
  position: relative;
  &::after {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    border-bottom: 1px solid $bgc;
    content: '';

    @media screen and (-webkit-min-device-pixel-ratio: 2) {
      transform: scaleY(0.5);
    }
    @media screen and (-webkit-min-device-pixel-ratio: 3) {
      transform: scaleY(0.333);
    }

  }
}

```



